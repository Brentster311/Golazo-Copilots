import pygame
from game.constants import STATE_MENU, STATE_GAME, STATE_HELP

class StateManager:
    def __init__(self):
        self._states = {}
        self._current_state = None
        self._current_state_name = None

    def change_state(self, state_name: str) -> None:
        if state_name not in self._states:
            if state_name == STATE_MENU:
                from game.states.menu_state import MenuState
                self._states[state_name] = MenuState()
            elif state_name == STATE_GAME:
                from game.states.game_state import GameState
                self._states[state_name] = GameState()
            elif state_name == STATE_HELP:
                from game.states.help_state import HelpState
                self._states[state_name] = HelpState()
        self._current_state = self._states[state_name]
        self._current_state_name = state_name

    def handle_event(self, event: pygame.event.Event) -> None:
        if self._current_state:
            next_state = self._current_state.handle_event(event)
            if next_state:
                self.change_state(next_state)

    def update(self, dt: float) -> None:
        if self._current_state:
            self._current_state.update(dt)

    def draw(self, screen: pygame.Surface) -> None:
        if self._current_state:
            self._current_state.draw(screen)
