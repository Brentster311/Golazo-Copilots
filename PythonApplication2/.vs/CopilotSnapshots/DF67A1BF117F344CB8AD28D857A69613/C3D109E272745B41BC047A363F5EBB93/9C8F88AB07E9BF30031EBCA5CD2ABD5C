"""California Jack game state model."""

from dataclasses import dataclass, field
from typing import List, Optional

from game.models.card import Card
from game.models.deck import Deck


@dataclass
class CaliforniaJackGame:
    """
    Represents the state of a California Jack game.
    
    Attributes:
        player1_hand: Cards in player 1's hand
        player2_hand: Cards in player 2's hand
        stock: The remaining deck (stock pile)
        trump_suit: The trump suit for this hand
        current_player: Which player's turn it is (1 or 2)
    """
    
    player1_hand: List[Card] = field(default_factory=list)
    player2_hand: List[Card] = field(default_factory=list)
    stock: Deck = field(default_factory=Deck)
    trump_suit: str = ""
    current_player: int = 1
    
    @classmethod
    def new_game(cls, seed: Optional[int] = None) -> 'CaliforniaJackGame':
        """
        Create a new game with shuffled deck and dealt hands.
        
        According to California Jack rules:
        - Each player gets 6 cards
        - Remaining cards form the stock (face-up, top card visible)
        - Top card of stock determines trump suit
        - Player 1 (non-dealer) leads first
        
        Args:
            seed: Optional random seed for deterministic dealing (useful for testing)
            
        Returns:
            A new CaliforniaJackGame instance ready to play
        """
        # Create and shuffle deck
        deck = Deck()
        deck.shuffle(seed=seed)
        
        # Deal 6 cards to each player (opponent/player1 first per rules)
        player1_hand = deck.deal(6)
        player2_hand = deck.deal(6)
        
        # Remaining 40 cards form the stock
        # Top card determines trump suit
        top_card = deck.top_card()
        trump_suit = top_card.suit if top_card else ""
        
        return cls(
            player1_hand=player1_hand,
            player2_hand=player2_hand,
            stock=deck,
            trump_suit=trump_suit,
            current_player=1  # Player 1 (non-dealer) leads first
        )
